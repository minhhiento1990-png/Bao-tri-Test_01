<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Offline Inspection Tablet Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#1e40af;color:#fff;padding:12px;text-align:center;font-weight:bold}
section{padding:12px}
input,select,button{width:100%;padding:8px;margin:4px 0}
button{background:#1e40af;color:#fff;border:none;border-radius:6px}
button:disabled{opacity:0.4}
.card{background:#fff;padding:12px;border-radius:8px;margin-bottom:12px}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:center}
.status-Normal{color:green;font-weight:bold}
.status-Alert{color:orange;font-weight:bold}
.status-Danger{color:red;font-weight:bold}
.tab{display:none}
.tab.active{display:block}
</style>
</head>

<body>

<header>OFFLINE INSPECTION TABLET DEMO</header>

<section>
<button onclick="showTab('entry')">Nháº­p liá»‡u</button>
<button onclick="showTab('dashboard')">Dashboard</button>
</section>

<!-- TAB ENTRY -->
<section id="entry" class="tab active">
<div class="card">
<h3>Nháº­p liá»‡u kiá»ƒm tra</h3>

<select id="device">
<option>TK-101</option>
<option>HE-202</option>
<option>VS-305</option>
</select>

<input id="inspector" placeholder="TÃªn ká»¹ thuáº­t viÃªn">
<input id="thickness" type="number" step="0.1" placeholder="Äá»™ dÃ y (mm)">

<button onclick="saveData()">LÆ¯U Dá»® LIá»†U</button>
</div>
</section>

<!-- TAB DASHBOARD -->
<section id="dashboard" class="tab">
<div class="card">
<canvas id="trendChart" height="150"></canvas>
</div>

<div class="card">
<h3>Lá»‹ch sá»­ kiá»ƒm tra</h3>
<table>
<thead>
<tr>
<th>NgÃ y</th>
<th>Thiáº¿t bá»‹</th>
<th>Tráº¡ng thÃ¡i</th>
<th>Report</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</section>

<script>
/* ===== LOCAL STORAGE DB ===== */
function getDB(){
  return JSON.parse(localStorage.getItem("inspectionDB")||"[]");
}
function saveDB(db){
  localStorage.setItem("inspectionDB",JSON.stringify(db));
}

/* ===== TAB ===== */
function showTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="dashboard") loadDashboard();
}

/* ===== STATUS ===== */
function getStatus(t){
  if(t<8.5) return "Danger";
  if(t<9.5) return "Alert";
  return "Normal";
}

/* ===== SAVE DATA ===== */
function saveData(){
  let db=getDB();
  let rec={
    id:Date.now(),
    date:new Date().toLocaleDateString(),
    device:device.value,
    inspector:inspector.value,
    thickness:Number(thickness.value),
    status:getStatus(Number(thickness.value)),
    pdf:false
  };
  db.push(rec);
  saveDB(db);
  alert("âœ… ÄÃ£ lÆ°u vÃ o tablet");
  thickness.value="";
}

/* ===== DASHBOARD ===== */
function loadDashboard(){
  let db=getDB();
  let body=document.getElementById("tableBody");
  body.innerHTML="";
  let chartData={};

  db.forEach(r=>{
    if(!chartData[r.device]) chartData[r.device]=[];
    chartData[r.device].push(r.thickness);

    let tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${r.date}</td>
      <td>${r.device}</td>
      <td class="status-${r.status}">${r.status}</td>
      <td>
        ${r.pdf
          ? `<button onclick="alert('File Ä‘Ã£ náº±m trong Downloads')">ðŸ“‚ Má»Ÿ</button>`
          : `<button onclick="printPDF(${r.id})">ðŸ–¨ In</button>`
        }
      </td>`;
    body.appendChild(tr);
  });

  drawChart(chartData);
}

/* ===== PDF ===== */
function printPDF(id){
  let db=getDB();
  let r=db.find(x=>x.id===id);
  const {jsPDF}=window.jspdf;
  let pdf=new jsPDF();
  pdf.text("INSPECTION REPORT",20,20);
  pdf.text(`Date: ${r.date}`,20,40);
  pdf.text(`Device: ${r.device}`,20,50);
  pdf.text(`Inspector: ${r.inspector}`,20,60);
  pdf.text(`Thickness: ${r.thickness} mm`,20,70);
  pdf.text(`Status: ${r.status}`,20,80);
  pdf.save(`Report_${r.device}_${r.id}.pdf`);
  r.pdf=true;
  saveDB(db);
  loadDashboard();
}

/* ===== CHART ===== */
let chart;
function drawChart(data){
  let ctx=document.getElementById("trendChart");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{
      labels:data[Object.keys(data)[0]]?.map((_,i)=>i+1)||[],
      datasets:Object.keys(data).map(d=>({
        label:d,
        data:data[d],
        borderWidth:2
      }))
    }
  });
}
</script>

</body>
</html>
